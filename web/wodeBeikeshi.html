<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE8" /><!-- ie7以ie8识别 -->
<title>品格学习云平台</title>

<!-- css加载 -->
<link rel="stylesheet" href="css/qr_base.css" type="text/css">
<link rel="stylesheet" href="css/form.css" type="text/css">
<link rel="stylesheet" href="css/table.css" type="text/css">
<link rel="stylesheet" href="css/style.css" type="text/css">
<link rel="stylesheet" href="" type="text/css" id="width1200">
<link rel="stylesheet" href="css/font-awesome.min.css" type="text/css">
<!-- js加载 -->
<script type="text/javascript" src="js/jquery-1.7.2.min.js"></script>
    <script type="text/javascript" src="lib/template/underscore.js"></script>
    <script type="text/javascript" src="lib/template/template.js"></script>
    <script type="text/javascript" src="lib/layer/1.9.3/layer.js"></script>

    <script type="text/javascript" src="js/page.js"></script>
    <script type="text/javascript" src="js/pinge.js"></script>
</head>
<body>

<!-- 头部start -->
<div id="header" class="wrapbox headbg" include="include/head.html"></div>
<!-- 头部end -->
<!-- 导航start -->
<div id="header-nav" class="wrapbox navbg" include="include/navigation.html"></div>
<!-- 导航end -->

<!-- 我的备课室开始 -->   
    <div class="container beikeshileftbg">
        <div class="leftbox fl">
          <dl>
            <dd id="all" class="on"  onclick="" ><a href="wodeBeikeshi.html"><span class="menuicon m_wenjian"></span>全部文件</dd>
            <dd id="pic" onclick="switchType(2,'pic')"><a href="javascript:void(0);"><span class="menuicon m_tupian"></span>图片</a></dd>
            <dd id="video" onclick="switchType(4,'video')"><a href="javascript:void(0);"><span class="menuicon m_shipin"></span>视频</a></dd>
            <dd id="document" onclick="switchType(3,'document')"><a href="javascript:void(0);"><span class="menuicon m_wendang"></span>文档</a></dd>
            <dd id="other"  onclick="switchType(6,'other')"><a href="javascript:void(0);"><span class="menuicon m_qita"></span>其他</a></dd>
            <dd ><a href="wodeGongxiang.html"><span class="menuicon m_gongxiang"></span>我的共享</a></dd>
            <dd ><a href="wodeHuishouzhan.html"><span class="menuicon m_huishouzhan"></span>回收站</a></dd>
          </dl>

          <dl class="neicundaxiao">
            <dt><span><i class="bg_green"  id="percentSize"></i></span></dt>
            <dt id="usesizeAndTotalSize"></dt>
          </dl>
        </div>
        <div class="rightbox fr">

          <dl class="anniuzu">
            <span class="fr">
              <!--<a href="javascript:;" class="btn_yellow fl" onclick="file_upload_show('文件上传',800,500);"><i class="fa fa-cloud-upload"></i>上传文件</a>-->
                <a href="javascript:void(0)" id="backDir" onclick="backDir()" class="color_blue">返回上一步</a>
                <a href="javascript:;" id="shangchuanwenjian" class="btn_yellow fr" onclick="popushow('.shangchuanwenjian',null,null);"><i class="fa fa-cloud-upload"></i>上传文件</a>
                <a href="javascript:;" class="btn_green fr" onclick="popushow('.xinjianwenjianjia',null,null);"><i class="fa fa-folder"></i>新建文件夹</a>

                <!--  selectCourseProject()
              <a href="javascript:;" class="btn_green fl" id="shangchuanjindu"><i class="fa fa-upload"></i>上传进度</a>
              -->

            </span>
            <span class="fl">
                <a ><i class="fa fa-th-large"></i>网格</a>
                <a ><i class="fa fa-navicon"></i>列表</a>


            </span>          
          </dl>

            <!-- 图片形式 开始-->
            <div class="beikeshibox">
                <table class="table_list beiketable" style="width:100%;">
                    <thead>
                    <tr>
                        <th><span class="fl">
                <label class="color_6"><input type="checkbox" name="selecttpall" id="selecttpAll" onclick="selectTPAll()">&nbsp;全选</label>

                <a href="javascript:void(0);" onclick="shareFile(2)"><i class="fa fa-share-alt"></i>共享</a>
                            <!--<a href="javascript:void(0);"><i class="fa fa-cloud-download"></i>下载</a>&lt;!&ndash; <a href="javascript:void(0);" class="nodownload"><i class="fa fa-cloud-download"></i>下载</a> &ndash;&gt;-->
                <a href="javascript:void(0);" onclick="delFile(2)" ><i class="fa fa-trash"></i>删除</a>
                <a href="javascript:void(0);" onclick="popushow('.xiugaimingzi',2,null);"><i class="fa fa-pencil-square-o"></i>重命名</a> <!-- bukedian不可操作 -->
                <a href="javascript:void(0);" onclick="popushow('.yidongdao',null,null);"><i class="fa fa-rotate-right"></i>移动到</a>
              </span></th>
                    </tr>
                    </thead>
                    <tbody >
                    <tr class="tupianxingshi">
                        <td>

                            <div  id="DiskFilewg" class="beikeliebiao">


                            </div>
                            <div id="pages2" class="page"></div>
                        </td>

                    </tr>
                    </tbody>
                </table>
            </div>
            <!-- 图片形式 结束-->

          <!-- 列表形式 开始-->
          <div class="beikeshibox">
          <table class="table_list beiketable" style="width:100%;">
          <thead>
            <tr>
              <th><span class="fl"><label class="color_6"><input type="checkbox" name="selectlball" id="selectlbAll" onclick="selectLBAll()">&nbsp;全选</label>
                <a href="javascript:void(0);" onclick="shareFile(1)"><i class="fa fa-share-alt"></i>共享</a>
                <a href="javascript:void(0);" onclick="delFile(1)" ><i class="fa fa-trash"></i>删除</a>
                <a href="javascript:void(0);" onclick="popushow('.xiugaimingzi',1,null);"><i class="fa fa-pencil-square-o"></i>重命名</a><!-- bukedian不可操作 -->
                <a href="javascript:void(0);" onclick="popushow('.yidongdao',1,null);"><i class="fa fa-rotate-right"></i>移动到</a></span>
              </th>
                <th width="15%" class="ac">大小</th>
                <th width="15%" class="ac">时间</th>
              <th width="15%" class="ac">操作</th>
            </tr>            
          </thead>
          <tbody id="DiskFilelb">

          </tbody>


          </table>
              <div id="pages" class="page"></div>
          </div>
          <!-- 列表形式 结束-->
          





        </div>
    </div>
<!-- 我的备课室结束 --> 

<!-- 通用底部开始 -->
<div id="foot" class="wrapbox footbg" include="include/foot.html"></div>
<!-- 通用底部结束 --> 
    <!--父类ID-->
   <input type="hidden" id="parentDirId" value="">


<!-- 新建文件夹 开始 -->
<div class="xinjianwenjianjia" style="display:none">
    <div class="blackbg transparent"></div>
    <div class="popu biaozhuntankuang">          
          <dl class="tktitle bg_green">新建文件夹 <a href="javascript:;" class="popu_close">×</a><!-- 关闭按钮 --></dl>  
          <form action="#">   
          <div class="tankuangdiv" style="margin-top:60px;">         
            <table class="nobordertable" style="width:100%" border="0">
              <tr>
                  <td class="ar">文件名：</td>
                  <td>
                      <input type="text" id="newDirName" class="ip-text ip-text-nomar" style="width:240px" placeholder="请输入文件夹名" />
                  </td>
              </tr>
              <tr>
                  <td class="ar">&nbsp;</td>
                  <td>
                      <input type="button"  onclick="mkdir('.xinjianwenjianjia')" value="确定" class="btn" />
                  </td>
              </tr>
            </table>
          </div>
          </form>
    </div>
</div>
<!-- 新建文件夹 结束 -->

<!-- 修改文件名字 开始 -->
<div class="xiugaimingzi" style="display:none">
    <div class="blackbg transparent"></div>
    <div class="popu biaozhuntankuang">          
          <dl class="tktitle bg_green">文件名修改 <a href="javascript:;" class="popu_close">×</a><!-- 关闭按钮 --></dl>   
          <form action="#">   
          <div class="tankuangdiv" style="margin-top:60px;">         
            <table class="nobordertable" style="width:100%" border="0">
              <tr>
                  <td class="ar">文件名：</td>
                  <td>
                      <input type="text" id="newFileId" style="display: none">
                      <input type="text" maxlength="30" id="newFileName" class="ip-text ip-text-nomar" style="width:240px" placeholder="请输入文件夹名" value="" />
                  </td>
              </tr>
              <tr>
                  <td class="ar">&nbsp;</td>
                  <td>
                      <input type="button"  onclick="rename('.xiugaimingzi')" value="保存" class="btn" />
                      <input id="filehouzhui" type="hidden" value="" />

                  </td>
              </tr>
            </table>
          </div>
          </form>
    </div>
</div>
<!-- 修改文件名字 结束 -->

<!-- 上传文件选择 开始 -->
<div class="shangchuanwenjian" style="display:none;">
    <div class="blackbg transparent"></div>
    <div id="tuodong" class="popu shangchuanxuanze">
          <dl  class="tktitle bg_green tuodong">上传文件 <a href="javascript:;" class="popu_close">×</a><!-- 关闭按钮 --></dl>
          <div class="tankuangdiv">      
            <table class="nobordertable" style="width:100%" border="0">
              <tr>
                  <td class="ar" width="70" style="padding:8px 5px;">文件名：</td>
                  <td style="padding:8px 5px;">
                      <div id="browse" class="upload_btn" >
                        <span><i class="fa fa-cloud-upload" ></i>选择文件</span>
                      <!--</div><span style="display: inline-block; position: absolute; left: 130px; top: 15px;" id="browse1"></span>-->
                  </td>
              </tr>
              <tr>
                  <td class="ar">课堂专题：</td>
                  <td>
                      <span class="tips">（请勾选你上传的文件所属的课堂分类，可多选）</span>
                  </td>
              </tr>
              <tr>
                  <td class="ar">&nbsp;</td>
                  <td>
                      <div id="keshixuanzebox" class="keshixuanzebox">

                      </div>
                  </td>
              </tr>
              <tr>
                  <td class="ar">关键字：</td>
                  <td>
                      <span class="tips">（请填写你上传的文件所包含的关键字，多个关键字之间用“，”隔开）</span>
                  </td>
              </tr>
              <tr>
                  <td style="padding:0 5px;" class="ar">&nbsp;</td>
                  <td style="padding:0 5px;">
                      <input id="key" value="" type="text" class="ip-text" style="width:420px" placeholder="请输入关键字" />
                  </td>
              </tr>
              <tr>
                  <td style="padding:0 5px;" class="ar">&nbsp;</td>
                  <td style="padding:0 5px;">
                      <input id="upload-btn" type="button" value="开始上传" class="btn" />
                  </td>
              </tr>
            </table>
          </div>
    </div>
</div>
<!-- 上传文件选择 结束 -->

<!-- 上传进度 开始 -->
<div class="jindupopu">
      <dl class="tktitle bg_green" id="jindudaxiaohua">上传进度 <a href="javascript:;" class="popu_close" val="1">－</a><!-- 关闭按钮 --></dl>
      <div id="file-list" class="jinduliebiao">
        <dl class="title">
          <dd class="dd1">文件名</dd>
          <dd class="dd2">大小</dd>
          <dd class="dd3">上传目录</dd>
          <dd class="dd4">状态</dd>
          <dd class="dd5">操作</dd>
        </dl>
      </div>
</div>

<script type="text/javascript" src="js/common.js"></script>


    <script type="text/javascript">
        //弹出的上传文件框鼠标拖动事件

                    $('.tuodong').mousedown(
                            function (event) {

                                var isMove = true;
                                var abs_x = event.pageX - $('#tuodong').offset().left;
                                var abs_y = event.pageY - $('#tuodong').offset().top;
                                $(document).mousemove(function (event) {
                                            if (isMove) {
                                                var obj = $('#tuodong');
                                                obj.css({'left':event.pageX - abs_x, 'top':event.pageY - abs_y});

                                            }
                                        }
                                ).mouseup(
                                        function () {
                                            isMove = false;
                                        }
                                );
                            }
                    );















        /*最小化最大化 上传进度*/
    $("#shangchuanjindu").click(function(){
          var obj=$("#jindudaxiaohua .popu_close");
          obj.text("－");     
          obj.attr("val",0);   
          $(".jindupopu").css({height:"auto"});
    })
    $("#jindudaxiaohua").click(function(){
        var obj=$("#jindudaxiaohua .popu_close");
        var val=obj.attr("val");
        if(val==0){
          obj.text("＋");
          obj.attr("val",1);
          $(".jindupopu").css({height:"40px"});
        }else{
          obj.text("－");     
          obj.attr("val",0);   
          $(".jindupopu").css({height:"auto"});
        }
    })

    /*上传进度暂停 开始*/
    $(".jinduliebiao dl #zanting").each(function(e){
      $(this).click(function(){
        var val=$(this).attr("val");
        if(val==0){
          $(this).text("▸");
          $(this).attr("val",1);
        }else{
          $(this).text("∥");     
          $(this).attr("val",0);   
        }
      })
    })
    </script>
<!-- 上传进度 结束 -->

<!-- 移动到 开始 -->
<link rel="stylesheet" href="css/zTreeStyle.css" type="text/css"><!-- 树形插件-->
<script type="text/javascript" src="js/jquery.ztree.core.js"></script><!-- 树形插件-->
<!-- 树形结构开始 -->
  <SCRIPT type="text/javascript">
    <!--
    var setting = {
      view: {
        dblClickExpand: false,
        showLine: false
      },
      data: {
        simpleData: {
          enable: true
        }
      },
      callback: {
        onClick: onClick
      }
    };


    function onClick(e,treeId, treeNode) {
      var zTree = $.fn.zTree.getZTreeObj("treeDemo");
        var  nodes = zTree.getSelectedNodes(true);

      zTree.expandNode(treeNode);
    }


    //-->
    //加载树形菜单
      function loadDirTreeData(){
          var fid=$("#moveFid").val().split(',');
          ajaxGetFun("MyFile/selectFileDirList",{fid:fid[0]},function(res){
              //移除已经选择的文件夹
              var bizData = res.bizData;
              var shu="";
              for(var i=0;i<bizData.length;i++){
                  for(var y=0;y<fid.length;y++){
                      if(bizData[i].id==fid[y]){
                          if(shu==""){
                              shu+=i;
                          }else{
                              shu+=","+i;
                          }

                      }
                  }
              }


              if(shu!=""){
                  var xiangtong = shu.split(",");
                  for(var i=0;i<xiangtong.length;i++){
                      bizData.splice(xiangtong[i],1);
                  }

              }


              $.fn.zTree.init($("#treeDemo"), setting, treeFormat(bizData));
              var treeObj = $.fn.zTree.getZTreeObj("treeDemo");
              var nodes = treeObj.getNodes();

              treeObj.selectNode(nodes[0]);

          },null,"加载树形菜单")

      }
    //移动文件
   function moveFilePath(){
       var zTree = $.fn.zTree.getZTreeObj("treeDemo");
       var  nodes = zTree.getSelectedNodes(true);
        if(nodes.length==0){
            layer.msg("请选择要移动到的文件夹", {icon: 5, time: 1000});
            return false;
        }
     var fids=$("#moveFid").val();

       var fid = fids.split(',');
       for(var i=0;i<fid.length;i++){

           ajaxGetFun("MyFile/movefile",{sourceId:fid[i],targetId:nodes[0].id},function(res){
               layer.msg("操作成功", {icon: 6, time: 1000});
               loadMydiskFileList(returnlastFileId(),1);
           },null, "移动文件")

       }



   }
  </SCRIPT>
<!-- 树形结构结束 -->
<div class="yidongdao" style="display:none">
    <div class="blackbg transparent"></div>
    <div class="popu wenjianyidongpopu">          
          <dl class="tktitle bg_green">移动到 <a href="javascript:;" class="popu_close">×</a><!-- 关闭按钮 --></dl>   
          <form action="#">   
          <div class="tankuangdiv">
              <input type="hidden" id="moveFid">
            <table class="nobordertable" style="width:100%" border="0">
              <tr>
                  <td class="al" colspan="2">
                        <!-- 树形结构开始 -->
                        <ul id="treeDemo" class="ztree"></ul>
                        <!-- 树形结构结束 -->
                  </td>
              </tr>
              <tr>
                  <td class="ac"><input type="button" onclick="moveFilePath()" value="确定" class="btn popuclose_btn" /></td>
                  <!--<td class="ar"><a href="javascript:;" class="btn_yellow fr" onclick=""><i class="fa fa-folder"></i>新建文件夹</a></td>-->
              </tr>
            </table>
          </div>
          </form>
    </div>
</div>
<!-- 移动到结束 -->

<script type="text/javascript" src="js/disk.js"></script>
<script>
    var pagesize=10;
    var results = 0;
    var search_condition="";//存储当前搜索条件
    var fid="";
    $(function(){
        var type=getQueryStr(location.href,'type');
        var typeid=getQueryStr(location.href,'typeid');
         //type 跳转类型  typeid 跳转id
        if(type=="" || typeid==''){
            loadMyDiskInfo();
        }else{
            switchType(typeid,type);
        }
    })
    //读取我的网盘信息
    function loadMyDiskInfo() {
        ajaxGetFun("CloudDisc/myDiskInfo", "", function (res) {
           var data=res.bizData;
            var objdata=res.bizData.object;
            $("#percentSize").css("width",(objdata.usedSize/objdata.totalSize)*100+"%");
            $("#usesizeAndTotalSize").html(data.usedsize+"/"+data.totalsize);
            $("#parentDirId").val(data.myfile_id);
            //加载网盘数据
            fid=data.myfile_id;
            loadMydiskFileList(data.myfile_id,1);
        }, null, "读取我的网盘信息")
    }
    //重新加载
    function reloadMyDiskInfo() {
        ajaxGetFun("CloudDisc/myDiskInfo", "", function (res) {
            var data=res.bizData;
            var objdata=res.bizData.object;
            $("#percentSize").css("width",(objdata.usedSize/objdata.totalSize)*100+"%");
            $("#usesizeAndTotalSize").html(data.usedsize+"/"+data.totalsize);
        }, null, "重新加载")
    }
    //新建文件夹
    function mkdir(obj){
        var pid=returnlastFileId();
        var fname=$("#newDirName").val();
        if(fname.length>=30  || fname==""){
            layer.msg("文件夹名称不能为空且不能大于30字", {icon: 5, time: 1000});
            return false;
        }
        url="MyFile/mkdir/"+pid;
          ajaxPostFun(url,{folderName:fname},function(res){
              layer.msg("保存成功!", {icon: 6, time: 1000});

            loadMydiskFileList(returnlastFileId(),1);
              $("#newDirName").val("");
        },null, "新建文件夹")
		$(obj).fadeOut(100);
    }

    // 读取我的网盘文件
    function loadMydiskFileList(parentId,page){
          loadBackir();// 监测是否显示返回上一步

         var csshref=$("#width1200").attr("href");

        var index=csshref.indexOf("1200");
        var wglimit="";

        if(index<0){
            //21
            wglimit=15;
        }else{
            //15
            wglimit=21;
        }
        requestDiskFileInfo(parentId,page,10,1)
        requestDiskFileInfo(parentId,page,wglimit,2)
    }

    /**
     * 请求网盘数据
     * @param parentId
     * @param page
     * @param limit
     * @param type
     */
    function  requestDiskFileInfo(parentId,page,limit,type){
        var con="";
        if(search_condition==""){
            if(parentId!=""){
                con="&parent_id="+parentId;
            }
        }
        var url="MyFile/mylist/"+page+"?"+search_condition+con;
        ajaxGetFun(url,{pagesize:limit}, function (res) {
            records = res.bizData;
            pagesize=records.pagesize;
            results = records.records;
            if(type==1){
                loadDiskInfoLB(records);
                setpage("pages",results,page,limit);
            }else{
                if(records.rows.length>0 && page>1){
                    loadDiskInfoWG(records);
                    setpage("pages2",results,page,limit);
                }else if(records.rows.length==0 && page==1){
                    $("#DiskFilewg").html("<img src='images/testimg/zanwushuju.png' style='width:100%;'>");
                    setpage("pages2",results,page,limit);
                }else{
                    loadDiskInfoWG(records);
                    setpage("pages2",results,page,limit);
                }
            }


        }, null, "请求网盘数据")
    }
    // 读取我的网盘文件
    function loadGoFileList(parentId,page){
        loadBackir();// 监测是否显示返回上一步

        var csshref=$("#width1200").attr("href");

        var index=csshref.indexOf("1200");
        var wglimit="";

        if(index<0){
            //21
            wglimit=15;
        }else{
            //15
            wglimit=21;
        }
        GoDiskFileInfo(parentId,page,10,1)
        GoDiskFileInfo(parentId,page,wglimit,2)
    }
    /**
     * 进入网盘请求
     * @param target
     */
    function  GoDiskFileInfo(parentId,page,limit,type){
        var url="MyFile/mylist/"+page;
        ajaxGetFun(url,{parent_id:parentId,pagesize:limit}, function (res) {
            records = res.bizData;
            pagesize=records.pagesize;
            results = records.records;
            if(type==1){
                loadDiskInfoLB(records);
                setpage("pages",results,page,limit);
            }else{

                    loadDiskInfoWG(records);
                    setpage("pages2",results,page,limit);
            }


        },null, "进入网盘请求")
    }
    //分页事件
    function gotopage(target) {
        pageIndex = target;//当前页码
        var parentDirId=returnlastFileId();
        loadMydiskFileList(parentDirId,target);
        //分页栏id，总页数，目标页码，每页显示条数
        setpage("pages",results,target,pagesize);
    }
    //列表
    function loadDiskInfoLB(records){

        var data=records.rows;
        var trs="";
         if(data.length==0){
            trs='<tr><td colspan="4" style="text-align:center;"><img src="images/testimg/zanwushuju.png" style="width:100%;"></td></tr>';
         }else {
             for (var i = 0; i < data.length; i++) {
                 var dow = "";
                 if (data[i].type != "adir") {
                     dow = '<a href="javascript:void(0);" onclick="downloades(' + data[i].id + ')" style="background-color:#15b649;color: white"><i class="fa fa-cloud-download"></i>下载</a>';
                 }else{
                     dow = '--';
                 }
                 var fileTypei = ifFileTypeLb(data[i].type);

                 if(data[i].type == "adir"){
                     trs += '<tr class="liebiaoxingshi" fid="' + data[i].id + '">'
                             + '<td class="lbal al"><input type="checkbox"  fname="' + data[i].name + '"  value="' + data[i].id + '" suffix="' + data[i].type + '" name="lbinput"><a href="javascript:void(0)" fid="' + data[i].id + '" suffix="' + data[i].type + '" onclick="clickFile(this)">' + fileTypei + namelength(data[i].name) + '</td>'
                             +'<td class="lbac ac">' + '--' + '</td>'
                             +'<td class="lbac ac">' + data[i].createdate.substring(0,11)+ '</td>'
                             + '<td class="lbac ac">' + dow + '</td>'
                             + '</tr>';

                 }else{
                 trs += '<tr class="liebiaoxingshi" fid="' + data[i].id + '">'
                         + '<td class="lbal al"><input type="checkbox"  fname="' + data[i].name + '"  value="' + data[i].id + '" suffix="' + data[i].type + '" name="lbinput"><a href="javascript:void(0)" fid="' + data[i].id + '" suffix="' + data[i].type + '" onclick="clickFile(this)">' + fileTypei + namelength(data[i].name) + '</td>'
                         +'<td class="lbac ac">' + getFormetFileSize(data[i].size) + '</td>'
                         +'<td class="lbac ac">' + data[i].createdate.substring(0,11)+ '</td>'
                         + '<td class="lbac ac">' + dow + '</td>'
                         + '</tr>';

                 }
             }
         }
        $("#DiskFilelb").html(trs);
    }
    //截取名字显示时的长度
    function namelength(name){
        var nametype = name.substring(name.indexOf("."),name.length);
        name=name.substring(0,name.indexOf("."));
        if(name.length>30){
           name = name.substring(0,30)+"..."+nametype;
        }else{
            name=name+nametype;
        }
       // alert(name);
        return name;

    }
    //网格
    function loadDiskInfoWG(records){
        var data=records.rows;
        var trs="";
		if(data.length==0){
			trs='<div style="text-align:center;"><img src="images/testimg/zanwushuju.png" style="width:100%;"></div>';
		}else{
			for(var i=0;i<data.length;i++){
				var dow="";
				var fileTypei=ifFileTypeWG(data[i].type);
				var name = data[i].name;
				if(name.length > 5){
					name = name.substr(0,9)+"...";
				}
				trs+='<dl title="'+data[i].name+'" fname="'+data[i].name+'" fid="'+data[i].id+'" suffix="'+data[i].type+'" ><a href="javascript:void(0)" fid="'+data[i].id+'" suffix="'+data[i].type+'" onclick="clickFile(this)">'
						+fileTypei
						+'<dd>'+name+'</dd>'
						+'</a><span class="xuanze"></span>'
						+'</dl>';

			}
		}
        

        $("#DiskFilewg").html(trs);
        $(".beikeliebiao dl").each(function(e){
            $(this).find("span").click(function(){
                if($(this).parent().hasClass("on")){
                    $(this).parent().attr("class","");
                }else{
                    $(this).parent().attr("class","on");
                }
            })
        })
    }
    //判断文件类型列表
    function ifFileTypeLb(type){
        var str="";
        if(type==".txt"){
            str='<i class="small_ico lb_txt"></i>';
        }else if(type==".pdf"){
            str='<i class="small_ico lb_pdf"></i>';
        }else if(type==".doc" || type==".docx"){
            str='<i class="small_ico lb_word"></i>';
        }else if(type==".xls" || type==".xlsx"){
            str='<i class="small_ico lb_excel"></i>';
        }else if(type==".ppt" || type==".pptx"){
            str='<i class="small_ico lb_ppt"></i>';
        }else if(type==".rar" || type==".zip"){
            str='<i class="small_ico lb_rar"></i>';
        }else if(type==".mp3"){
            str='<i class="small_ico lb_music"></i>';
        }else if(type==".png" || type==".jpg"|| type==".gif"|| type==".jpeg"|| type==".bmp"){
            str='<i class="small_ico lb_tupian"></i>';
        }else if(type==".avi" || type==".rmvb" || type==".mp4" || type==".3gp" || type==".wma" || type==".wmv"){
            str='<i class="small_ico lb_shipin"></i>';
        }else if(type=="adir"){
            str='<i class="small_ico lb_wenjian"></i>';
        }else{
            //未知
            str='<i class="small_ico lb_qita"></i>';
        }
        return str;

    }
    //判断文件类型网格
    function ifFileTypeWG(type){
        var str="";
        if(type==".txt"){
            str='<dt class="lx_txt"></dt>';
        }else if(type==".pdf"){
            str='<dt class="lx_pdf"></dt>';
        }else if(type==".doc" || type==".docx"){
            str='<dt class="lx_word"></dt>';
        }else if(type==".xls" || type==".xlsx"){
            str='<dt class="lx_excel"></dt>';
        }else if(type==".ppt" || type==".pptx"){
            str='<dt class="lx_ppt"></dt>';
        }else if(type==".rar" || type==".zip"){
            str='<dt class="lx_rar"></dt>';
        }else if(type==".mp3"){
            str='<dt class="lx_music"></dt>';
        }else if(type==".png" || type==".jpg"|| type==".gif"|| type==".jpeg"|| type==".bmp"){
            str='<dt class="lx_tupian"></dt>';
        }else if(type==".avi" || type==".rmvb" || type==".mp4" || type==".3gp" || type==".wma" || type==".wmv"){
            str='<dt class="lx_shipin"></dt>';
        }else if(type=="adir"){
            str='<dt class="lx_wenjian"></dt>';
        }else{
           str='<dt class="lx_qita"></dt>';
        }
        return str;
    }
    //点击文件
    function clickFile(obj){
        var suffix=$(obj).attr("suffix");
        var fid=$(obj).attr("fid");
        if(suffix=="adir"){

            var pdid=$("#parentDirId").val();
            $("#parentDirId").val(pdid+","+fid);

            loadGoFileList(fid,1);
        }else{
            window.open(openFile(suffix,fid)+"&source=my");
        }

    }
    //返回最后一位文件ID
    function returnlastFileId(){
        var padid=$("#parentDirId").val();
        var pdid=padid.split(",");
       return pdid[pdid.length-1];
    }
    //返回前一位文件ID
    function returnbeforeFileId(){
        var padid=$("#parentDirId").val();
        var pdid=padid.split(",");
        if(pdid.length>=2){
            return pdid[pdid.length-2];
        }else{
            return pdid[pdid.length-1];
        }
    }
    //返回除最后以为的其他ID
    　function returnlastIdbefore() {
         var padid=$("#parentDirId").val();
         var paddids=new Array();
          paddids=padid.split(",")
           paddids.pop();
         var str = paddids.join(",");

         return str
     }
    //检测是否显示返回上一页
    function loadBackir(){
        var padid=$("#parentDirId").val();
        var pdid=padid.split(",");
        if(pdid.length>=2){
            $("#backDir").show();
        }else{
            $("#backDir").hide();
        }
    }
    //返回上一页
    function backDir(){
        var padid=$("#parentDirId").val();

        var pdid=padid.split(",");
        if(pdid.length>=2){
            $("#parentDirId").val(returnlastIdbefore());


            loadMydiskFileList(returnlastFileId(),1);
        }else{
            layer.msg("已到根目录", {icon: 5, time: 1000});

        }

    }
    //获取选中的多选框
    function  getCheckedBox(type) {
        var checkId="";
        var checklist="";
        var checkedList=new Array();
        var num=0;
        if(type==1){
            //列表
            checklist = document.getElementsByName("lbinput");
            for(var i=0;i<checklist.length;i++){
                var obj = checklist[i];
                if(obj.type=='checkbox'){
                    if(obj.checked==true){

                        checkedList[num]=obj;
                        num++;
                        checkId+="fileIds="+obj.value+"&";
                    }
                }
            }
        }else{
            checklist = $(".beikeliebiao dl");
            for(var i=0;i<checklist.length;i++){
                var obj = checklist[i];
                if($(obj).attr("class")=="on"){

                    checkId+="fileIds="+$(obj).attr("fid")+"&";
                    checkedList[num]=obj;
                    num++;
                }
            }
        }
        if(checkId==""){
            layer.msg("请选择文件!", {icon: 5, time: 1000});
            return false;
        }
        var arrary=new Array();
        arrary[0]=checkId;
        arrary[1]=checkedList;
        return arrary;
    }
    //分享
    function shareFile(type){
        var arrary=getCheckedBox(type);
        if(!arrary){
            return;
        }
        var checkId=arrary[0];
        var checklist=arrary[1];
        ajaxGetFun("MyFile/share?"+checkId,"",function(res){
            layer.msg(res.bizData, {icon: 6, time: 1000});
            if(type==1){
                for(var j=0;j<checklist.length;j++)
                {
                    checklist[j].checked = 0;
                }
            }else{
                for(var j=0;j<checklist.length;j++)
                {
                    checklist[j].attr("class","");
                }
            }
        },null,"分享文件")
    }
    //删除
   function delFile(type){
		var arrary=getCheckedBox(type);
		   if(!arrary){
			   return;
		   }
		var tpl = '<div style="text-align:center;">确认要把所选文件放入回收站吗？<br />删除的文件可在30天内通过回收站还原</div>';
		layer.confirm(tpl,{icon: 3, title:'确认删除'},function(index){
		   var checkId=arrary[0];
		   var checklist=arrary[1];
		   ajaxGetFun("MyFile/remove?"+checkId,"",function(res){
			   layer.msg("删除成功!", {icon: 6, time: 1000});
			   loadMydiskFileList(returnlastFileId(),1);
		   },null,"把所选文件放入回收站")
		});
   }
    //重命名
    function rename(obj){
       var fid=$("#newFileId").val();
        var fname=$("#newFileName").val();
        var filehouzhui=$("#filehouzhui").val();
        fname+=filehouzhui;
        var url="MyFile/rename/"+fid;
		if(empty(fname)){
			layer.msg("请输入文件名", {icon: 5, time: 1000});
			return false;
		}
        ajaxPostFun(url,{name:fname},function(res){
            layer.msg("保存成功!", {icon: 6, time: 1000});
            loadMydiskFileList(returnlastFileId(),1);
        },null,"重命名")
		$(obj).fadeOut(100);
    }
    function switchType(mode,obj){

        $("#"+obj).parent().children().removeClass("on");
        $("#"+obj).addClass("on");
        var parid="";

        switch(parseInt(mode)){
            case 1://全部
                search_condition = "";
                parid=fid;
                break;
            case 2://图片
                search_condition = createLink("pattern",image_arrs);
                break;
            case 3://文档
                search_condition = createLink("pattern",document_arrs);
                break;
            case 4://视频
                search_condition = createLink("pattern",video_arrs);
                break;
            case 5://音乐
                search_condition = createLink("pattern",music_arrs);
                break;
            case 6://其他
                search_condition = createLink("pattern",all_arrs)+"&"+"direction=1&notdir=1";
                break;
            case 7://我的共享
                search_condition ="isshare=1";
                break;
            case 8://回收站
                search_condition ="status=1";
                break;
            default :
                search_condition = "";
                parid=fid;
                break;
        }
        $("#parentDirId").val(fid);
            reloadMyDiskInfo();
        loadMydiskFileList(parid,1);
    }
    //创建搜索链接
    function createLink(key,datalist){
        var link = "";
        var length = datalist.length;
        for(var i=0;i<length;i++){
            if(i == length - 1){
                link += key+"="+datalist[i];
            }else{
                link += key+"="+datalist[i]+"&";
            }
        }
        return link;
    }
    //下载
    function downloades(fileid){
//        window.open(basePath+"MyFile/"+fileid+"/downloadMyFile");
        window.open(basePath+"MyFile/"+fileid+"/download");
    }
    //查询课堂专题
    function selectCourseProject(){
        ajaxGetFun("CourseProject/selectAllList","",function(res){
           var data=res.bizData;
            var trs="";
            for(var i=0;i<data.length;i++){
                trs+=' <span><label><input type="checkbox" value="'+data[i].id+'" name="keshi">'+data[i].name+'</label></span>';
            }
            $("#keshixuanzebox").html(trs);
        },null, "查询课堂专题")
    }
    selectCourseProject();
</script>


<script type="text/javascript">
/*列表形式 全选*/
function selectLBAll(){
 var checklist = document.getElementsByName("lbinput");
   if(document.getElementById("selectlbAll").checked)
   {
   for(var i=0;i<checklist.length;i++)
   {
      checklist[i].checked = 1;
   }
 }else{
  for(var j=0;j<checklist.length;j++)
  {
     checklist[j].checked = 0;
  }
 }
}
/*图片形式 全选*/
function selectTPAll(){
 var checklist = $(".beikeliebiao dl");
  if(document.getElementById("selecttpAll").checked)
   {
   for(var i=0;i<checklist.length;i++)
   {
      checklist.attr("class","on");
   }
 }else{
  for(var j=0;j<checklist.length;j++)
  {
      checklist.attr("class","");
  }
 }
}
/*图片形式 单独选中*/
//$(".beikeliebiao dl").each(function(e){
//    $(this).find("span").click(function(){
//        if($(this).parent().hasClass("on")){
//            $(this).parent().attr("class","");
//        }else{
//            $(this).parent().attr("class","on");
//        }
//    })
//})


$(function(){
  /*列表 网格切换*/
  b_tab($(".anniuzu .fl a"),$(".beikeshibox"),"on");

})

</script>

</body>
</html>
<script type="text/javascript" src="lib/plupload/plupload.full.min.js"></script>
<script type="text/javascript" src="lib/plupload/jquery.plupload.queue/jquery.plupload.queue.min.js"></script>
<script type="text/javascript" src="js/cloudyDisk.js"></script>
